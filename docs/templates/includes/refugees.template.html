{% if refugees.length() > 0 %}
{% set refugee_date = refugees.max("reference_period_start") %}
{% set latest_refugees = refugees.withRows("reference_period_start", refugee_date).cache() %}
<div class="infobox">
  <div class="key-figure">
    <span class="date">{{ refugee_date | truncate(4, true, "") }}</span>
    <span class="label">Refugees</span>
    <span class="figure">{{ latest_refugees.withRows("age_range", "all").withRows("gender", "all").sum("population") | nfmt }}</span>
    {% for gender in [["f", "female"], ["m", "male"]] %}
    {% set population = latest_refugees.withRows("gender", gender[0]).sum("population") %}
    {% if population > 0 %}
    <div class="supplemental-figure">
      <span class="label">{{ gender[1] }}</span>
      {{ population | nfmt }}
    </div>
    {% endif %}
    {% endfor %}
  </div>
</div>
{% endif %}
